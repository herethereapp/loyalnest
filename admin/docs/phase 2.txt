Phase 2: Core Feature Expansion + Admin Enhancements (4 Months)

Goal:

Add **Should Have** features: VIP tiers (spending-based), advanced RFM configuration, exit-intent popups, Klaviyo/Mailchimp integration, multi-store point sharing, behavioral segmentation, and enhance admin module.

Enhancements & Best Practices:

- Conduct bi-weekly feedback sessions with beta testers (surveys, interviews, PostHog analytics).
- Maintain public changelog for transparency.
- Implement i18n framework for future multilingual support.
- Add k6 load testing to CI/CD for RFM and VIP tier updates.
- Monitor metrics: RFM wizard completion (80%+), referral conversion (5%+), RFM segment movement (10%+ to higher tiers).
- Define acceptance criteria for outsourced UI/QA work.

Features:

1. Program - Referrals:
   - Configure rewards for referrer/friend (e.g., points, discounts).
   - Add social sharing (Facebook, Instagram) via referral links.
   - Status toggle (active/disable).

2. Program - VIP Tiers:
   - Thresholds: Spending or engagement-based (e.g., Silver: $100+, Gold: $500+).
   - Perks: Early product access, birthday gifts, exclusive discounts.
   - Track tier changes in `vip_tiers` (with `rfm_criteria` JSONB), notify via email.

3. Program - Activity:
   - Display points, referrals, VIP tier changes in logs.
   - Filter by customer/date.

4. Analytics:
   - Reports: Loyalty-driven revenue, redemption rate, RFM tier engagement, repeat purchase rate.
   - Chart.js visualizations for tier engagement.

5. On-Site Content:
   - Exit-intent popups, discount banners, point calculators, checkout extensions.
   - Launchers: Apple/Google Wallet integration.

6. Settings:
   - Advanced RFM configuration: Thresholds (Recency, Frequency, Monetary), tiers, adjustment frequency (daily/weekly).
   - Setup wizard with pre-filled thresholds (e.g., Recency 5: <30 days, Monetary 5: $250+ for AOV $50).
   - Chart.js preview for segment sizes.

7. Integrations:
   - Klaviyo (advanced events), Mailchimp, Yotpo Email & SMS for personalized campaigns.
   - Email templates for points, rewards, VIP tiers.

8. Other:
   - Multi-store point sharing.
   - Behavioral segmentation (e.g., purchase frequency, churn risk).

9. Admin Module Enhancements:
   - Plan upgrades/downgrades, integration health checks, RFM config management.
   - Admin roles (superadmin, support) in `admin_users.metadata`.

Database Schema:

- Add `vip_tiers` (with `rfm_criteria` JSONB), `email_templates`, `email_events`, `integrations`.
- Indexes: `vip_tiers(merchant_id)`, `email_templates(merchant_id)`.
- Sync RFM configs to `customer_segments`, `vip_tiers`.

Tasks:

1. Backend (NestJS/TypeScript):
   - APIs: `/api/referrals` (social sharing), `/api/vip-tiers`, `/api/rfm-config`, `/api/activity`, `/api/analytics` (advanced reports).
   - Integrations: Klaviyo/Mailchimp/Yotpo APIs for RFM notifications, email campaigns.
   - Cache VIP tiers, RFM configs in Redis.
   - Use AI for code, Jest tests; manually review.

2. Backend (Rust/Wasm):
   - Shopify Functions: VIP multipliers, real-time RFM tier updates.
   - Generate Rust code, `cargo test` cases with AI.

3. Frontend (Vite + React):
   - Pages: `ReferralsPage.tsx` (social sharing), `VIPPage.tsx` (tiers), `RFMConfigPage.tsx` (thresholds, wizard), `ActivityPage.tsx`, `IntegrationsPage.tsx`.
   - Update `AnalyticsPage.tsx` with RFM tier reports.
   - On-Site Content: Exit-intent popups, discount banners, point calculators.
   - Admin frontend: Plan management, RFM config view.
   - Use AI for components, Cypress tests; outsource Polaris review ($1,000).

4. Database:
   - Add tables for VIP tiers, email templates, integrations.
   - Optimize indexes for RFM and VIP queries.

5. Testing:
   - Unit: Jest for APIs, RFM/VIP logic.
   - Integration: Klaviyo/Mailchimp/Yotpo, RFM tier updates.
   - E2E: RFM UI, popups, admin roles (Cypress).
   - Load test: 5,000+ customers with Redis caching.

6. Deployment:
   - Optimize Redis caching for RFM, VIP, analytics on VPS.
   - Plan AWS ECS migration for future scaling.

Timeline:

- Month 8–9: Social referrals, VIP tiers, Klaviyo/Mailchimp integration.
- Month 10–11: Advanced RFM config, activity logs, popups, admin enhancements.

Deliverables:

- **Should Have** features: Social referrals, VIP tiers, advanced RFM, Klaviyo/Mailchimp, popups, behavioral segmentation, multi-store point sharing.
- Enhanced admin module with RFM config and plan management.
- Updated test suite, VPS deployment with Docker and Nginx.
- Merchant documentation with RFM setup and integration guides.